{
  "id": "main",
  "initial": "waiting",
  "states": {
    "waiting": { "on": { "start_test": { "target": "auto_test_1" } } },
    "auto_test_1": {
      "type": "compound",
      "initial": "starting",
      "states": {
        "starting": {
          "invoke": {
            "src": {
              "type": "task",
              "taskId": "airflow",
              "config": {
                "parameters": { "dagId": "dag1", "data": "$" },
                "resultSelector": {
                  "foo": "bar",
                  "baz": "har",
                  "message": "$.message",
                  "dag_execution_date": "$.execution_date"
                },
                "resultPath": "$.pipeline1.apiResponse"
              }
            },
            "onDone": { "target": "started" },
            "onError": { "target": "failed_to_start" }
          }
        },
        "started": {
          "on": {
            "task_success": {
              "target": "#main.ready_for_approval",
              "resultSelector": { "a": "a", "b": "b", "out": "$" },
              "resultPath": "$.pipeline1.success"
            },
            "task_failure": {
              "target": "#main.failed",
              "resultSelector": { "c": "c", "d": "d", "out": "$" },
              "resultPath": "$.pipeline1.error"
            }
          }
        },
        "failed_to_start": {}
      }
    },
    "ready_for_approval": {
      "on": {
        "reject": { "target": "failed", "resultPath": "$.reject.data" },
        "approve": { "target": "auto_test_2", "resultPath": "$.approval.data" }
      }
    },
    "auto_test_2": {
      "type": "compound",
      "initial": "starting",
      "states": {
        "starting": {
          "invoke": {
            "src": {
              "type": "task",
              "taskId": "airflow",
              "config": {
                "parameters": { "dagId": "dag2", "data": "$" },
                "resultSelector": {
                  "foo": "bar",
                  "baz": "har",
                  "message": "$.message",
                  "dag_execution_date": "$.execution_date"
                },
                "resultPath": "$.pipeline2.apiResponse"
              }
            },
            "onDone": { "target": "started" },
            "onError": { "target": "failed_to_start" }
          }
        },
        "started": {
          "on": {
            "task_success": {
              "target": "#main.done",
              "resultSelector": { "e": "e", "out": "$" },
              "resultPath": "$.pipeline2.success"
            },
            "task_failure": {
              "target": "#main.failed",
              "resultSelector": { "f": "f", "out": "$" },
              "resultPath": "$.pipeline2.error"
            }
          }
        },
        "failed_to_start": {}
      }
    },
    "done": { "type": "final" },
    "failed": { "type": "final" }
  }
}
